#!/usr/bin/lua

local cities = {
	au1 = 'ğŸ‡¦ğŸ‡º Sydney',
	au2 = 'ğŸ‡¦ğŸ‡º Sydney',
	au3 = 'ğŸ‡¦ğŸ‡º Melbourne',
	au4 = 'ğŸ‡¦ğŸ‡º Melbourne',
	au5 = 'ğŸ‡¦ğŸ‡º Sydney',
	au6 = 'ğŸ‡¦ğŸ‡º Sydney',
	au7 = 'ğŸ‡¦ğŸ‡º Sydney',
	at1 = 'ğŸ‡¦ğŸ‡¹ Vienna',
	at2 = 'ğŸ‡¦ğŸ‡¹ Vienna',
	be1 = 'ğŸ‡§ğŸ‡ª Brussels',
	be2 = 'ğŸ‡§ğŸ‡ª Brussels',
	be3 = 'ğŸ‡§ğŸ‡ª Brussels',
	be4 = 'ğŸ‡§ğŸ‡ª Brussels',
	br1 = 'ğŸ‡§ğŸ‡· SÃ£o Paulo',
	bg1 = 'ğŸ‡§ğŸ‡¬ Sofia',
	bg2 = 'ğŸ‡§ğŸ‡¬ Sofia',
	bg3 = 'ğŸ‡§ğŸ‡¬ Sofia',
	ca1 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca2 = 'ğŸ‡¨ğŸ‡¦ Vancouver',
	ca3 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca4 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca5 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca6 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca7 = 'ğŸ‡¨ğŸ‡¦ Vancouver',
	ca8 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	ca9 = 'ğŸ‡¨ğŸ‡¦ MontrÃ©al',
	cz4 = 'ğŸ‡¨ğŸ‡¿ Prague',
	cz5 = 'ğŸ‡¨ğŸ‡¿ Prague',
	dk1 = 'ğŸ‡©ğŸ‡° Copenhagen',
	dk2 = 'ğŸ‡©ğŸ‡° Copenhagen',
	fi1 = 'ğŸ‡«ğŸ‡® Helsinki',
	fi2 = 'ğŸ‡«ğŸ‡® Helsinki',
	fi3 = 'ğŸ‡«ğŸ‡® Helsinki',
	fr1 = 'ğŸ‡«ğŸ‡· Paris',
	fr2 = 'ğŸ‡«ğŸ‡· Paris',
	fr3 = 'ğŸ‡«ğŸ‡· Paris',
	fr4 = 'ğŸ‡«ğŸ‡· Paris',
	fr5 = 'ğŸ‡«ğŸ‡· Paris',
	fr6 = 'ğŸ‡«ğŸ‡· Paris',
	fr7 = 'ğŸ‡«ğŸ‡· Paris',
	fr8 = 'ğŸ‡«ğŸ‡· Paris',
	de1 = 'ğŸ‡©ğŸ‡ª Frankfurt',
	de2 = 'ğŸ‡©ğŸ‡ª Frankfurt',
	de4 = 'ğŸ‡©ğŸ‡ª Frankfurt',
	de5 = 'ğŸ‡©ğŸ‡ª Frankfurt',
	de6 = 'ğŸ‡©ğŸ‡ª Frankfurt',
	hk1 = 'ğŸ‡­ğŸ‡° Hong Kong',
	hu1 = 'ğŸ‡­ğŸ‡º Budapest',
	hu2 = 'ğŸ‡­ğŸ‡º Budapest',
	ie1 = 'ğŸ‡®ğŸ‡ª Dublin',
	ie2 = 'ğŸ‡®ğŸ‡ª Dublin',
	it1 = 'ğŸ‡®ğŸ‡¹ Milan',
	it2 = 'ğŸ‡®ğŸ‡¹ Milan',
	it3 = 'ğŸ‡®ğŸ‡¹ Milan',
	jp1 = 'ğŸ‡¯ğŸ‡µ Tokyo',
	jp2 = 'ğŸ‡¯ğŸ‡µ Tokyo',
	jp3 = 'ğŸ‡¯ğŸ‡µ Tokyo',
	jp4 = 'ğŸ‡¯ğŸ‡µ Tokyo',
	jp5 = 'ğŸ‡¯ğŸ‡µ Tokyo',
	lv1 = 'ğŸ‡±ğŸ‡» Riga',
	lu1 = 'ğŸ‡±ğŸ‡º Luxembourg',
	lu2 = 'ğŸ‡±ğŸ‡º Luxembourg',
	md1 = 'ğŸ‡²ğŸ‡© ChiÈ™inÄƒu',
	nl1 = 'ğŸ‡³ğŸ‡± Amsterdam',
	nl2 = 'ğŸ‡³ğŸ‡± Amsterdam',
	nl3 = 'ğŸ‡³ğŸ‡± Amsterdam',
	nl4 = 'ğŸ‡³ğŸ‡± Amsterdam',
	nl5 = 'ğŸ‡³ğŸ‡± Amsterdam',
	nz1 = 'ğŸ‡³ğŸ‡¿ Auckland',
	nz2 = 'ğŸ‡³ğŸ‡¿ Auckland',
	no1 = 'ğŸ‡³ğŸ‡´ Oslo',
	no2 = 'ğŸ‡³ğŸ‡´ Oslo',
	no3 = 'ğŸ‡³ğŸ‡´ Oslo',
	no4 = 'ğŸ‡³ğŸ‡´ Oslo',
	pl1 = 'ğŸ‡µğŸ‡± Warsaw',
	pl2 = 'ğŸ‡µğŸ‡± Warsaw',
	pl3 = 'ğŸ‡µğŸ‡± Warsaw',
	pl4 = 'ğŸ‡µğŸ‡± Warsaw',
	ro1 = 'ğŸ‡·ğŸ‡´ Bucharest',
	ro2 = 'ğŸ‡·ğŸ‡´ Bucharest',
	ro3 = 'ğŸ‡·ğŸ‡´ Bucharest',
	rs1 = 'ğŸ‡·ğŸ‡¸ Belgrade',
	rs2 = 'ğŸ‡·ğŸ‡¸ Belgrade',
	sg1 = 'ğŸ‡¸ğŸ‡¬ Singapore',
	sg2 = 'ğŸ‡¸ğŸ‡¬ Singapore',
	sg3 = 'ğŸ‡¸ğŸ‡¬ Singapore',
	es1 = 'ğŸ‡ªğŸ‡¸ Madrid',
	es2 = 'ğŸ‡ªğŸ‡¸ Madrid',
	es3 = 'ğŸ‡ªğŸ‡¸ Madrid',
	es4 = 'ğŸ‡ªğŸ‡¸ Madrid',
	es5 = 'ğŸ‡ªğŸ‡¸ Madrid',
	se1 = 'ğŸ‡¸ğŸ‡ª MalmÃ¶',
	se2 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se3 = 'ğŸ‡¸ğŸ‡ª Gothenburg',
	se4 = 'ğŸ‡¸ğŸ‡ª MalmÃ¶',
	se5 = 'ğŸ‡¸ğŸ‡ª Gothenburg',
	se6 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se7 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se8 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se9 = 'ğŸ‡¸ğŸ‡ª Gothenburg',
	se10 = 'ğŸ‡¸ğŸ‡ª Gothenburg',
	se12 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se13 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	se14 = 'ğŸ‡¸ğŸ‡ª Stockholm',
	ch1 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch2 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch3 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch4 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch5 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch6 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch7 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch8 = 'ğŸ‡¨ğŸ‡­ Zurich',
	ch9 = 'ğŸ‡¨ğŸ‡­ Zurich',
	gb1 = 'ğŸ‡¬ğŸ‡§ London',
	gb2 = 'ğŸ‡¬ğŸ‡§ London',
	gb3 = 'ğŸ‡¬ğŸ‡§ Manchester',
	gb4 = 'ğŸ‡¬ğŸ‡§ London',
	gb5 = 'ğŸ‡¬ğŸ‡§ London',
	gb6 = 'ğŸ‡¬ğŸ‡§ London',
	gb7 = 'ğŸ‡¬ğŸ‡§ Manchester',
	gb8 = 'ğŸ‡¬ğŸ‡§ Manchester',
	gb9 = 'ğŸ‡¬ğŸ‡§ Manchester',
	gb10 = 'ğŸ‡¬ğŸ‡§ Manchester',
	us1 = 'ğŸ‡ºğŸ‡¸ New York',
	us2 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us3 = 'ğŸ‡ºğŸ‡¸ Miami',
	us4 = 'ğŸ‡ºğŸ‡¸ Chicago',
	us5 = 'ğŸ‡ºğŸ‡¸ Seattle',
	us6 = 'ğŸ‡ºğŸ‡¸ Atlanta',
	us7 = 'ğŸ‡ºğŸ‡¸ Dallas',
	us8 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us9 = 'ğŸ‡ºğŸ‡¸ Salt Lake City',
	us10 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us11 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us14 = 'ğŸ‡ºğŸ‡¸ Piscataway',
	us15 = 'ğŸ‡ºğŸ‡¸ Phoenix',
	us17 = 'ğŸ‡ºğŸ‡¸ Dallas',
	us18 = 'ğŸ‡ºğŸ‡¸ Chicago',
	us19 = 'ğŸ‡ºğŸ‡¸ Miami',
	us20 = 'ğŸ‡ºğŸ‡¸ Miami',
	us21 = 'ğŸ‡ºğŸ‡¸ Atlanta',
	us22 = 'ğŸ‡ºğŸ‡¸ Chicago',
	us23 = 'ğŸ‡ºğŸ‡¸ Chicago',
	us24 = 'ğŸ‡ºğŸ‡¸ Salt Lake City',
	us25 = 'ğŸ‡ºğŸ‡¸ Salt Lake City',
	us26 = 'ğŸ‡ºğŸ‡¸ Salt Lake City',
	us27 = 'ğŸ‡ºğŸ‡¸ Miami',
	us29 = 'ğŸ‡ºğŸ‡¸ New York',
	us30 = 'ğŸ‡ºğŸ‡¸ New York',
	us31 = 'ğŸ‡ºğŸ‡¸ New York',
	us32 = 'ğŸ‡ºğŸ‡¸ New York',
	us33 = 'ğŸ‡ºğŸ‡¸ New York',
	us34 = 'ğŸ‡ºğŸ‡¸ New York',
	us35 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us36 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us37 = 'ğŸ‡ºğŸ‡¸ Los Angeles',
	us38 = 'ğŸ‡ºğŸ‡¸ Atlanta',
	us39 = 'ğŸ‡ºğŸ‡¸ Atlanta',
	us40 = 'ğŸ‡ºğŸ‡¸ Miami',
	us41 = 'ğŸ‡ºğŸ‡¸ Miami',
	us42 = 'ğŸ‡ºğŸ‡¸ Miami',
	us43 = 'ğŸ‡ºğŸ‡¸ Miami'
}

local servers = {}
local city_list = 'âŒ Cancel\nğŸ”“ Stop VPN'

for k, v in pairs(cities) do
	servers[v] = k
end

for k, _ in pairs(servers) do
	city_list = city_list .. '\n' .. k
end

function close_old_instance()
	local is_running = os.execute('systemctl is-active wg-quick@*.service')
	if is_running then
		os.execute('systemctl stop wg-quick@*.service')
	end
end

local city_file = io.popen('echo "' .. city_list .. '" | rofi -dmenu -i -no-custom -p "Connect to â€¦"')
local city = string.sub(city_file:read('a'), 1, -2)

if city == 'ğŸ”“ Stop VPN' then
	close_old_instance()
elseif servers[city] then
	close_old_instance()
	os.execute('systemctl start wg-quick@mullvad-' .. servers[city] .. '.service')
end
